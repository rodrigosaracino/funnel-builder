services:
  funnel-builder:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: funnel-builder-app
    networks:
      - traefik
    volumes:
      # Persiste o banco de dados SQLite
      - funnel-data:/app/data
      # Opcional: Para desenvolvimento, monta o c√≥digo fonte
      # - .:/app
    environment:
      - PYTHONUNBUFFERED=1
      # Configurar webhook (opcional)
      # - WEBHOOK_URL=https://hooks.zapier.com/hooks/catch/123456/abcdef/
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.funnelbuilder.rule=Host(`funnelbuilder.amzcursos.com`)"
      - "traefik.http.routers.funnelbuilder.entrypoints=websecure"
      - "traefik.http.routers.funnelbuilder.tls.certresolver=letsencrypt"
      - "traefik.http.services.funnelbuilder.loadbalancer.server.port=8000"

volumes:
  funnel-data:
    driver: local

networks:
  traefik:
    external: true
